{"ast":null,"code":"import React,{createContext,useState,useCallback}from'react';import axios from'../axiosConfig';import{jsx as _jsx}from\"react/jsx-runtime\";const PostsContext=/*#__PURE__*/createContext();const PostsProvider=_ref=>{let{children}=_ref;const[posts,setPosts]=useState([]);const[userVotes,setUserVotes]=useState({});const fetchPostsAndVotes=useCallback(async clubId=>{try{const response=await axios.get(`/book-clubs/${clubId}`,{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});setPosts(response.data.posts||[]);const votes=response.data.posts.reduce((acc,post)=>{acc[post.id]=post.user_voted;return acc;},{});setUserVotes(votes);}catch(error){console.error('Error fetching posts and votes:',error);}},[]);const addPost=useCallback(async(clubId,content)=>{try{const response=await axios.post(`/book-clubs/${clubId}/posts`,{content},{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});setPosts(prevState=>[...(prevState||[]),response.data]);}catch(error){console.error('Error adding post:',error);throw error;}},[]);const editPost=useCallback(async(postId,content)=>{try{const response=await axios.patch(`/posts/${postId}`,{content},{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});setPosts(prevState=>(prevState||[]).map(post=>post.id===postId?response.data:post));}catch(error){console.error('Error editing post:',error);throw error;}},[]);const deletePost=useCallback(async postId=>{try{await axios.delete(`/posts/${postId}`,{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});setPosts(prevState=>(prevState||[]).filter(post=>post.id!==postId));}catch(error){console.error('Error deleting post:',error);throw error;}},[]);const votePost=useCallback(async(postId,vote)=>{try{const response=await axios.post(`/posts/${postId}/vote`,{vote},{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});setPosts(prevState=>(prevState||[]).map(post=>post.id===postId?response.data:post));setUserVotes(prev=>({...prev,[postId]:prev[postId]===vote?null:vote}));}catch(error){console.error('Error voting on post:',error);throw error;}},[]);return/*#__PURE__*/_jsx(PostsContext.Provider,{value:{posts,userVotes,fetchPostsAndVotes,addPost,editPost,deletePost,votePost},children:children});};export{PostsProvider,PostsContext};","map":{"version":3,"names":["React","createContext","useState","useCallback","axios","jsx","_jsx","PostsContext","PostsProvider","_ref","children","posts","setPosts","userVotes","setUserVotes","fetchPostsAndVotes","clubId","response","get","headers","Authorization","localStorage","getItem","data","votes","reduce","acc","post","id","user_voted","error","console","addPost","content","prevState","editPost","postId","patch","map","deletePost","delete","filter","votePost","vote","prev","Provider","value"],"sources":["/home/levi/Development/book-club/client/src/components/context/PostsContext.js"],"sourcesContent":["import React, { createContext, useState, useCallback } from 'react';\nimport axios from '../axiosConfig';\n\n\nconst PostsContext = createContext();\n\nconst PostsProvider = ({ children }) => {\n\n  const [posts, setPosts] = useState([]);\n  const [userVotes, setUserVotes] = useState({});\n\n  const fetchPostsAndVotes = useCallback(async (clubId) => {\n    try {\n      const response = await axios.get(`/book-clubs/${clubId}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      setPosts(response.data.posts || []);\n\n      const votes = response.data.posts.reduce((acc, post) => {\n        acc[post.id] = post.user_voted;\n        return acc;\n      }, {});\n\n      setUserVotes(votes);\n    } catch (error) {\n      console.error('Error fetching posts and votes:', error);\n    }\n  }, []);\n\n  const addPost = useCallback(async (clubId, content) => {\n    try {\n      const response = await axios.post(`/book-clubs/${clubId}/posts`, { content }, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      setPosts((prevState) => [...(prevState || []), response.data]);\n    } catch (error) {\n      console.error('Error adding post:', error);\n      throw error;\n    }\n  }, []);\n\n  const editPost = useCallback(async (postId, content) => {\n    try {\n      const response = await axios.patch(`/posts/${postId}`, { content }, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      setPosts((prevState) =>\n        (prevState || []).map((post) => (post.id === postId ? response.data : post))\n      );\n    } catch (error) {\n      console.error('Error editing post:', error);\n      throw error;\n    }\n  }, []);\n\n  const deletePost = useCallback(async (postId) => {\n    try {\n      await axios.delete(`/posts/${postId}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      setPosts((prevState) => (prevState || []).filter((post) => post.id !== postId));\n    } catch (error) {\n      console.error('Error deleting post:', error);\n      throw error;\n    }\n  }, []);\n\n  const votePost = useCallback(async (postId, vote) => {\n    try {\n      const response = await axios.post(`/posts/${postId}/vote`, { vote }, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      setPosts((prevState) =>\n        (prevState || []).map((post) => (post.id === postId ? response.data : post))\n      );\n      setUserVotes((prev) => ({ ...prev, [postId]: prev[postId] === vote ? null : vote }));\n    } catch (error) {\n      console.error('Error voting on post:', error);\n      throw error;\n    }\n  }, []);\n\n  return (\n    <PostsContext.Provider value={{ posts, userVotes, fetchPostsAndVotes, addPost, editPost, deletePost, votePost }}>\n      {children}\n    </PostsContext.Provider>\n  );\n};\n\nexport { PostsProvider, PostsContext };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}